
<!DOCTYPE html>
<html class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <link rel="canonical" href="https://www.floydhub.com/guides/deep_corrector/">
      
      
        <meta name="author" content="FloydHub Team">
      
      
        <link rel="shortcut icon" href="../../assets/images/favicon.ico">
      
      <meta name="generator" content="mkdocs+mkdocs-material#1.0.3">
    
    
      
        <title>Deep Text Corrector - FloydHub</title>
      
    
    
      <script src="../../assets/javascripts/modernizr-facb31f4a3.js"></script>
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Source+Code+Pro">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Source Code Pro","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application-f3ab63f78a.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-02ce7adcc2.palette.css">
      
      
        <link rel="stylesheet" href="../../css/bootstrap_paper.min.css">
      
    
    
  </head>
  
  
  
  
    <body data-md-color-primary="blue" data-md-color-accent="blue">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="FloydHub" class=" md-logo  md-header-nav__button">
          
            <img src="../../img/f_white_small.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Guides
                </span>
              
            
            Deep Text Corrector
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <div class="md-search__overlay"></div>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false">
      <label class="md-icon md-search__icon" for="search"></label>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result"></div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            
          </div>
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container">
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <i class=" md-logo  md-nav__button">
      
        <img src="../../img/f_white_small.png">
      
    </i>
    FloydHub
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  <li class="md-nav__item">
    
      <a href="../.." title="Home" class="md-nav__link">
        Home
      </a>
    
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Get Started
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-2">
        Get Started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../home/getting_started/" title="First Floyd Project" class="md-nav__link">
        First Floyd Project
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../home/using_datasets/" title="Using Datasets" class="md-nav__link">
        Using Datasets
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../home/managing_output/" title="Managing Output" class="md-nav__link">
        Managing Output
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../home/installing_dependencies/" title="Installing Dependencies" class="md-nav__link">
        Installing Dependencies
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../home/environments/" title="Environments" class="md-nav__link">
        Environments
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Guides
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-3">
        Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../jupyter/" title="Jupyter Notebook" class="md-nav__link">
        Jupyter Notebook
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../style_transfer/" title="Style Transfer" class="md-nav__link">
        Style Transfer
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Deep Text Corrector
      </label>
    
    <a href="./" title="Deep Text Corrector" class="md-nav__link md-nav__link--active">
      Deep Text Corrector
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#project-setup" title="Project setup" class="md-nav__link">
    Project setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#training" title="Training" class="md-nav__link">
    Training
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dataset" title="Dataset" class="md-nav__link">
    Dataset
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#training_1" title="Training" class="md-nav__link">
    Training
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evaluating" title="Evaluating" class="md-nav__link">
    Evaluating
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#improving-your-model" title="Improving your model" class="md-nav__link">
    Improving your model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evaluate-pre-trained-models" title="Evaluate pre-trained models" class="md-nav__link">
    Evaluate pre-trained models
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rest-api" title="Rest API" class="md-nav__link">
    Rest API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-next" title="What Next?" class="md-nav__link">
    What Next?
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../datasets/" title="Public Datasets" class="md-nav__link">
        Public Datasets
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../contributing/" title="Contributing" class="md-nav__link">
        Contributing
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Commands
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-4">
        Commands
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../commands/" title="floyd" class="md-nav__link">
        floyd
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../commands/login/" title="floyd login" class="md-nav__link">
        floyd login
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../commands/init/" title="floyd init" class="md-nav__link">
        floyd init
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../commands/run/" title="floyd run" class="md-nav__link">
        floyd run
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../commands/data/" title="floyd data" class="md-nav__link">
        floyd data
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../commands/logs/" title="floyd logs" class="md-nav__link">
        floyd logs
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../commands/status/" title="floyd status" class="md-nav__link">
        floyd status
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../commands/output/" title="floyd output" class="md-nav__link">
        floyd output
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../commands/info/" title="floyd info" class="md-nav__link">
        floyd info
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../commands/stop/" title="floyd stop" class="md-nav__link">
        floyd stop
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../commands/delete/" title="floyd delete" class="md-nav__link">
        floyd delete
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../commands/logout/" title="floyd logout" class="md-nav__link">
        floyd logout
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Floydhub
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-5">
        Floydhub
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../floydhub/privacy/" title="Privacy" class="md-nav__link">
        Privacy
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../floydhub/terms/" title="Terms of Service" class="md-nav__link">
        Terms of Service
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
  <li class="md-nav__item">
    
      <a href="../../faq/" title="FAQs" class="md-nav__link">
        FAQs
      </a>
    
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#project-setup" title="Project setup" class="md-nav__link">
    Project setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#training" title="Training" class="md-nav__link">
    Training
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dataset" title="Dataset" class="md-nav__link">
    Dataset
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#training_1" title="Training" class="md-nav__link">
    Training
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evaluating" title="Evaluating" class="md-nav__link">
    Evaluating
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#improving-your-model" title="Improving your model" class="md-nav__link">
    Improving your model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evaluate-pre-trained-models" title="Evaluate pre-trained models" class="md-nav__link">
    Evaluate pre-trained models
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rest-api" title="Rest API" class="md-nav__link">
    Rest API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-next" title="What Next?" class="md-nav__link">
    What Next?
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
               
              
                
                  <h1>Deep Text Corrector</h1>
                
                <p>Deep Text Corrector is an Tensorflow project made by <a href="https://github.com/atpaino/deep-text-corrector">Alex Paino</a> 
for correcting grammatical errors in short sentences. For example, the message "I'm going to store" 
would be unaffected by typical autocorrection 
systems, when the user most likely intendend to write "I'm going to <em>the</em> store".</p>
<p>In this guide we will train a Tensorflow model for correcting sentences and use it to evaluate input sentences. 
Finally we will deploy the trained model as a REST endpoint that can 
be used to evaluate input sequences in real time.</p>
<h2 id="project-setup">Project setup</h2>
<p>The code for this project is available on Floyd's <a href="https://github.com/floydhub/deep-text-corrector">Github page</a>.
Clone the project and <a href="../../commands/init">initialize</a> a floyd project.</p>
<pre><code class="bash">$ git clone https://github.com/floydhub/deep-text-corrector
$ cd deep-text-corrector
$ floyd init deep-text-corrector
</code></pre>

<h2 id="training">Training</h2>
<h3 id="dataset">Dataset</h3>
<p>For this project we will use the Cornel Movie-Dialogs Corpus for training and testing. 
The dataset should be preprocessed and split into 3 sets: 80% for training, and 10% 
each for validation and testing. This preprocessed dataset is available publicly on 
<a href="https://www.floydhub.com/viewer/data/R26whR6Pikh8N5Dx3gfF2e/data/">FloydHub</a>.</p>
<h3 id="training_1">Training</h3>
<p>You can train the deep corrector model by running <code>correct_text.py</code> script with required 
parameters. Below is the <a href="../../commands/run">command</a> to start a training job on Floyd:</p>
<pre><code class="bash">$ floyd run --gpu --env tensorflow:py2 --data feNGtpH9tZSj79NeqchSEB &quot;python correct_text.py --num_steps 1000 --train_path /input/data/movie_dialog_train.txt --val_path /input/data/movie_dialog_val.txt --config DefaultMovieDialogConfig --data_reader_type MovieDialogReader --output_path /output&quot;
</code></pre>

<p>Notes:</p>
<ul>
<li>The input dataset is passed using the <code>--data</code> parameter. This mounts the pre-processed 
Cornell Movie Dialog dataset at <code>/input</code> path. You will notice that other parameters use files 
mounted in this path.</li>
<li>The data id <a href="https://www.floydhub.com/viewer/data/R26whR6Pikh8N5Dx3gfF2e/">feNGtpH9tZSj79NeqchSEB</a> 
points to the pre-processed dataset on FloydHub.</li>
<li>The job is run on a gpu instance (because of the <code>--gpu</code> flag). </li>
<li>This project uses Tensorflow installed on Python 2. (See the <code>--env</code> flag)</li>
</ul>
<p>This job takes about 10 minutes to run and generate a model. You can follow along the progress 
by using the <a href="../../commands/logs/">logs</a> command.</p>
<pre><code class="bash">$ floyd logs &lt;RUN_ID&gt; -t
</code></pre>

<p>Floyd saves any content stored in the <code>/output</code> directory after the job is finished. This output can 
be used as a datasource in the next project. 
To get the ID of the output generated by your job use the <a href="../../commands/info/">info</a> command.</p>
<pre><code class="bash">$ floyd info &lt;RUN_ID&gt;
</code></pre>

<h2 id="evaluating">Evaluating</h2>
<p>To evaluate your model you can run the <code>correct_text.py</code> script with the <code>decode</code> flag. 
You need a file containing short messages for evaluation. The <code>test.txt</code> file already has some 
inputs. You can update or add more strings to this file - one per line. You also need to 
use the output from the training step above as the datasource in this step.</p>
<pre><code class="bash">floyd run --gpu --env tensorflow:py2 --data &lt;REPLACE_WITH_OUTPUT_ID&gt; &quot;python correct_text.py --train_path /input/data/movie_dialog_train.txt --test_path test.txt --config DefaultMovieDialogConfig --data_reader_type MovieDialogReader --input_path /input --decode&quot;
</code></pre>

<p>You can track the status of the run with the status or logs command. The logs should print the 
concerted messages from the test.txt file.</p>
<pre><code class="bash">$ floyd status &lt;RUN_ID&gt;
$ floyd logs &lt;RUN_ID&gt; -t
</code></pre>

<h2 id="improving-your-model">Improving your model</h2>
<p>You may notice that the output does not look great. In fact, the algorithm would've added more 
mistakes into the sentences than correct it. That is because we ran the training for a small number 
of iterations. To train a fully working model try the training step again, this time by setting 
the flag <code>num_steps</code> to a large value. In general, about 20000 steps are necessary to give a 
working corrector model. (Note: This takes a few hours to run on the GPU instance)</p>
<h2 id="evaluate-pre-trained-models">Evaluate pre-trained models</h2>
<p>If you want to try out a pre-trained model, FloydHub has a public datasource
for this. Use the data source id <a href="https://www.floydhub.com/viewer/data/R26whR6Pikh8N5Dx3gfF2e/">feNGtpH9tZSj79NeqchSEB</a>
and you will have access to this.</p>
<pre><code class="bash">floyd run --gpu --env tensorflow:py2 --data feNGtpH9tZSj79NeqchSEB &quot;python correct_text.py --train_path /input/data/movie_dialog_train.txt --test_path test.txt --config DefaultMovieDialogConfig --data_reader_type MovieDialogReader --input_path /input --decode&quot;
</code></pre>

<p>This model should perform better on the given inputs compared to the previous model.</p>
<h2 id="rest-api">Rest API</h2>
<p>Coming Soon!</p>
<h2 id="what-next">What Next?</h2>
<p>The model was trained using movie dialogues which are not the greatest sources of gramatically correct 
sentences. An improvement to this approach would be to use other datasources like <a href="https://www.gutenberg.org/">Project Gutenberg</a>.
This project was also discussed on <a href="https://news.ycombinator.com/item?id=13350972">HackerNews</a> and you can 
find lots of interesting alternatives there.</p>
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../style_transfer/" title="Style Transfer" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Style Transfer
              </span>
            </div>
          </a>
        
        
          <a href="../datasets/" title="Public Datasets" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Public Datasets
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2017 Floyd Labs Inc.
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application-2afe21e0b2.js"></script>
      <script>var config={url:{base:"../.."}},app=new Application(config);app.initialize()</script>
      
    
    
      
    
  </body>
</html>