<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="FloydHub Team">
        <link rel="canonical" href="https://www.floydhub.com/guides/">
        <link rel="shortcut icon" href="../img/favicon.ico">

	<title>Guides - FloydHub</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">
        <link href="../css/base.css" rel="stylesheet">
        <link href="../css/bootstrap_paper.min.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="..">FloydHub</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="..">Home</a>
                </li>
            
            
            
                <li >
                    <a href="../installation/">Installation</a>
                </li>
            
            
            
                <li class="active">
                    <a href="./">Guides</a>
                </li>
            
            
            
                <li >
                    <a href="../commands/">Commands</a>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                <li >
                    <a rel="next" href="../installation/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../commands/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#floyd-guides">Floyd Guides</a></li>
        
            <li><a href="#jupyter-notebook">Jupyter Notebook</a></li>
        
            <li><a href="#floyd-serving">Floyd Serving</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="floyd-guides">Floyd Guides</h1>
<h2 id="jupyter-notebook">Jupyter Notebook</h2>
<p><a href="http://jupyter.org/">Jupyter</a> or <a href="https://ipython.org/">IPython</a> is an open source project that allows you 
to create and share documents that contain live code, equations, visualizations and explanatory text. This 
guide will show you how to run a Jupyter notebook on Floyd.</p>
<h3 id="setup-project">Setup project</h3>
<p>Clone a project which contain deep learning jupyter notebooks. For 
example: <a href="https://github.com/aymericdamien/TensorFlow-Examples">aymericdamien/TensorFlow-Examples</a>.
Then initialize a floyd project inside that.</p>
<pre><code class="bash">$ cd TensorFlow-Examples/notebooks/3_NeuralNetworks
$ floyd init neural-networks
</code></pre>

<h3 id="run-in-jupyter-mode">Run in Jupyter mode</h3>
<p>Floyd <a href="#run">run</a> command has a <code>jupyter</code> mode. This will run upload the jupyter notebooks in the current 
directory and start a jupyter server for you.</p>
<pre><code class="bash">$ floyd run --mode jupyter
Syncing code ...
RUN ID                  NAME                          VERSION
----------------------  --------------------------  ---------
dMoDZaCcvQMyfNbgwTx9f8  floydhub/neural-networks:1          1

Path to jupyter notebook: https://www.floydhub.com:8000/EQDsTpeqB3RkjpHUgBGDyB

To view logs enter:
    floyd logs dMoDZaCcvQMyfNbgwTx9f8
</code></pre>

<p>You can open the link to your jupyter notebook. The notebooks should be available and you can run 
any of them.</p>
<p><img alt="Jupyter" src="../img/jupyter_home.png" /></p>
<h3 id="selecting-the-environment">Selecting the environment</h3>
<p>Jupyter notebooks also run in the same environments as other jobs. You can select any environment you want 
along with the <code>--env</code> parameter of the <a href="#run">run</a> command. You can see the list of supported environments
<a href="#environments">here</a>.</p>
<pre><code class="bash">$ floyd run --mode jupyter --env tensorflow_py2
Syncing code ...
</code></pre>

<h3 id="additional-dependencies">Additional dependencies</h3>
<p>If you have any additional python dependencies, you can also add a <code>floyd_requirements.txt</code> file to 
the notebook directory before floyd run. The packages specified there will be installed before running the 
jupyter server</p>
<h3 id="saving-jupyter-notebooks">Saving Jupyter Notebooks</h3>
<p>Floyd does not save your Jupyter notebooks after you stop the floyd job. So you need to download any 
relevant notebooks by selecting <code>File &gt; Download as</code> menu from the Jupyter notebook.</p>
<h3 id="stopping-the-job">Stopping the job</h3>
<p>Once you have experimented with your code, you still need to stop the job. Run the <a href="#stop">stop</a> command 
for this.</p>
<hr />
<h2 id="floyd-serving">Floyd Serving</h2>
<p>Floyd can be used to host REST apis of your trained models which can be accessed over the web. This feature 
is very useful if you want to quickly compare models or have others play with your models. This guide will 
walk you through how to do this.</p>
<h3 id="setup-project_1">Setup project</h3>
<p>Clone your favorite deep learning project. For this guide we will be using <a href="https://github.com/floydhub/fast-style-transfer">Fast Style Transfer</a>
project.</p>
<pre><code class="bash">$ git clone https://github.com/floydhub/fast-style-transfer
$ floyd init fast-style-transfer
</code></pre>

<h3 id="train-a-model">Train a model</h3>
<p>You can train your model by running the <code>train.py</code> script on Floyd. Specify the style image to use. This project also requires access to pre-trained
model - imagenet-vgg-verydeep-19.mat and some training data. Floyd already has this data source available <a href="../link">here</a>.</p>
<p>Note that the command uses a tensorflow_py2 environment because this code can run only on Python2.</p>
<pre><code class="bash">$ floyd run --gpu --data &lt;id&gt; &quot;python style.py --style ./examples/style/wave.jpg \
  --checkpoint-dir /output \
  --test-dir ./images/ \
  --content-weight 1.5e1 \
  --checkpoint-iterations 10 \
  --batch-size 20&quot;

</code></pre>

<p>This will kick off a new job on Floyd. This will take 30 minutes to run and will generate the model. Record the ID of the 
output generated by this run.</p>
<pre><code class="bash">$ floyd info &lt;id&gt;
</code></pre>

<h3 id="evaluate-your-model">Evaluate your model</h3>
<p>You can evaluate the generated model by running <code>evaluation.py</code> on sample images. Use the output id from the training step
as the datasource in this step. Add any image you want to evaluate to the <code>images</code> directory.</p>
<pre><code class="bash">$ floyd run --env tensorflow_py2 --data &lt;OUTPUT_ID_FROM_TRAINING&gt; &quot;python evaluate.py --checkpoint /input/wave.ckpt --in-path ./images/ --out-path /output/&quot;
</code></pre>

<p>You can track the status of the run with the status or logs command.</p>
<pre><code class="bash">$ floyd status &lt;RUN_ID&gt;
$ floyd logs &lt;RUN_ID&gt;
</code></pre>

<p>Now open the output to see the style transfered images.</p>
<pre><code class="bash">$ floyd output &lt;RUN_ID&gt;
</code></pre>

<h3 id="evaluate-pre-trained-model">Evaluate pre-trained model</h3>
<p>If you want to try out some awesome pre-trained models, we have a datasource for that available <a href="../link">ID:Js534T344XYBPMvWqhxJNj</a> publicly.
You can use that style transfer on any image you prefer. Just add them to <code>images</code> directory.</p>
<pre><code class="bash">$ floyd run --env tensorflow_py2 --data Js534T344XYBPMvWqhxJNj &quot;python evaluate.py --checkpoint /input/wave.ckpt --in-path ./images/ --out-path /output/&quot;
</code></pre>

<p>You can track the status of the run with the status command.</p>
<pre><code class="bash">$ floyd status &lt;RUN_ID&gt;
</code></pre>

<p>When the experiment is finished, you can see the style transfered images by running:</p>
<pre><code class="bash">$ floyd output &lt;RUN_ID&gt;
</code></pre>

<p><img alt="Jupyter" src="../img/taipei101_wave.jpg" /></p>
<h3 id="model-api">Model API</h3>
<p>You can now host this model as a REST API. This means you can send any image to this API as a HTTP request and it will be style transfered. </p>
<p>Floyd <a href="#run">run</a> command has a <code>serving</code> mode. This will upload the files in the current directory and run <code>python app.py</code>. Floyd expects 
this file to contain the code to run a web server and listen on port <code>5000</code>. You can see the 
<a href="https://github.com/floydhub/fast-style-transfer/blob/master/app.py">app.py</a> file in the sample repository. This file should handle the 
incoming request and execute the code in <code>evaluate.py</code> and returns the output.</p>
<pre><code class="bash">$ floyd run --env tensorflow_py2 --data Js534T344XYBPMvWqhxJNj --mode serving
Syncing code ...
RUN ID                  NAME                              VERSION
----------------------  ------------------------------  ---------
DJSdJAVa3u7AsFEMZMBBL5  floydhub/fast-style-transfer:5          5

Path to service endpoint: https://www.floydhub.com:8000/t4AdkU6awahkT3ooNazw8c

To view logs enter:
    floyd logs DJSdJAVa3u7AsFEMZMBBL5
</code></pre>

<p>Now you can send any image file as request to this api and it will return the style transfered image.</p>
<pre><code class="bash">curl -o taipei_output.jpg -F &quot;file=@./images/taipei101.jpg&quot; https://www.floydhub.com:8000/t4AdkU6awahkT3ooNazw8c
</code></pre>

<p><img alt="Jupyter" src="../img/taipei_muse.jpg" /></p>
<p>You will see the default style (<a href="#la_muse">la_muse</a>) is applied to the input image.</p>
<p>You can also pass in the checkpoint to use and the image will be style transfered accordingly:</p>
<pre><code class="bash">curl -o taipei_udnie.jpg -F &quot;file=@./images/taipei101.jpg&quot; -F &quot;checkpoint=udnie.ckpt&quot;  https://www.floydhub.com:8000/MUDFXViCLArG2drppvU3nm
</code></pre>

<p><img alt="Jupyter" src="../img/taipei_udnie.jpg" /></p>
<p>This uses a different style checkpoint to render the image. All the logic for this is present in the <code>app.py</code> file. You can update it to 
be as complex as you prefer.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            
                <center>Copyright &copy; 2017 Floyd Labs Inc.</center>
            
            <center>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</center>
        </footer>

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>